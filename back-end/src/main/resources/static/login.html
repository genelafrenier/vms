<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>SMS Login Page</title>
  <link href="styles/login.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="styles/navbar.css">
  <script src="js/navbar.js"></script>
</head>

  
<body>
  <div class="navbar-container" id="navbar"></div>
  <script>
      document.addEventListener('DOMContentLoaded', (event) => {
          loadNavbar();
      });
  </script>
<main>
  <div class="LoginPage">
    <!-- Start Of Login Form  -->
    <form class="ImbededBox" name="userLogin" id="loginForm">
      <div class="ID">
        <label for= "loginUsername"> Student or Employee ID: </label>
      </div>

      <!-- UserId Input  -->
      <div class="IdField">
        <input type = "text" id= "loginUsername" name= "userId" placeholder="Username">
      </div>

      <p class="Error" id="idInputError"></p>
      <br>

      <div class="Password">
        <label for= "loginPassword"> Password: </label>
      </div>

      <!-- User Password Input  -->
       <div class="PasswordField">
        <input type = "password" id= "loginPassword" name= "userPassword" placeholder = "Password">
       </div>

      <p class="Error" id="passwordInputError"></p>
      <br>

      <!-- LOGIN Button Triggers Form Validation - Submits If Successful Validation  -->
      <div class="LoginButton">
        <button type="submit" class="LoginBtn">LOGIN</button>
      </div>
      <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('loginForm').addEventListener('submit', function(event) {
                event.preventDefault();
                console.log('Form submitted');
                login();
            });
        });
    </script>

      <br>

      <!--Directs User To Create Account Page  -->
      <div class="CreateAccountButton">
        <a href="register.html">
        <button type="button" class="CreateAccountBtn">Create an account</button>
        </a>
      </div>

    </form>
  </div>
</main>

  <script>
  
    function login() {
        var username = document.getElementById("loginUsername").value;
        var password = document.getElementById("loginPassword").value;

        var data = {
            username: username,
            password: password
        };
        console.log("Login Triggered");

        fetch('http://localhost:8080/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify(data)
        })
        .then(response => {
          if (!response.ok){
            throw new Error(response.status);
          }
          if(response.ok){
            window.location.href = 'index.html';
          }
          return response.text();
        })
        .then(result => {
            alert(result);
            console.log(result);
            window.location.href = 'index.html';
        })
        .catch(error => console.error('Error:', error));
    }


  </script>
    

</body>

</html>